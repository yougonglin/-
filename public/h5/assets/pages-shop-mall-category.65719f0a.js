import{r as t,Q as e,d as a,o as l,c as i,w as s,i as n,a as o,u,R as r,g as d,h as m,F as p,U as c,G as f,b as v}from"./index-dd065053.js";import{_ as h}from"./uni-section.1e3d76cc.js";import{a as b,r as g}from"./uni-app.es.ce8d824d.js";import{_ as y}from"./cl-upload.0a80f3fb.js";import{_}from"./n-cell.b6cef899.js";import{_ as x}from"./uni-easyinput.e534a72b.js";import{_ as j}from"./n-check-static.bdada69e.js";import{_ as T}from"./n-button.b3507bff.js";import{_ as k}from"./n-tabs-h.b260a43b.js";import{_ as w}from"./uni-list-item.5e9f74de.js";import{j as U,k as V}from"./shop.dc051026.js";import{c as C}from"./request.d55298d6.js";import"./uni-cloud.es.a358b7b6.js";import"./n-icon.66eb4db5.js";import"./uni-icons.721cc791.js";import"./n-badge.07ff5dac.js";import"./system.bd116065.js";const S={__name:"category",setup(S){let F=t([]),R=t(C.HTTP_REQUEST_URL+"/app/index/upload"),E=[{title:"关闭",value:0},{title:"开启",value:1}],L=e({data:{}});t(null);let B=t([]),H=t([]),I=t(0),Q=t([]),z=t([1]),D=a((()=>t=>{for(let e=0;e<H.value.length;e++)if(H.value[e].id==t)return H.value[e].name;return"顶级分类"})),P=a((()=>t=>1==t?"已开启":"已关闭"));function q(t){I.value=t,U(H.value[t].id).then((t=>{Q.value=t.data.data}))}function A(){L.data={},F.value=[],z.value=[1]}function G(t){F.value.push(C.HTTP_REQUEST_URL+"/storage/"+t.data[0])}function O(){c({itemList:[...B.value,"顶级分类"],success:t=>{H.value.length-1<t.tapIndex?L.data.pid=0:L.data.pid=H.value[t.tapIndex].id}})}function J(){Reflect.set(L.data,"pic",F.value[0]),L.data.is_show=z.value[0],V(L.data).then((t=>{t.data.data?(f({title:"添加/更新成功"}),L.data.pid||K(0),A()):f({title:"添加/更新失败",icon:"error"})}))}function K(t){U(t).then((t=>{let e=[];for(let a=0;a<t.data.data.length;a++)e.push(t.data.data[a].name);B.value=e,H.value=t.data.data}))}return b((t=>{K(0)})),(t,e)=>{const a=g(v("uni-section"),h),c=g(v("cl-upload"),y),f=g(v("n-cell"),_),b=g(v("uni-easyinput"),x),U=n,V=g(v("n-check-static"),j),C=g(v("n-button"),T),S=g(v("n-tabs-h"),k),H=g(v("uni-list-item"),w);return l(),i(U,{class:""},{default:s((()=>[o(a,{class:"mb-10",title:"分类图标","sub-title":"",type:"line"}),o(c,{style:{margin:"26rpx"},imageFormData:{compress:!0},modelValue:u(F),"onUpdate:modelValue":e[0]||(e[0]=t=>r(F)?F.value=t:F=t),action:u(R),onOnSuccess:G},null,8,["modelValue","action"]),o(a,{class:"mb-10",title:"父级分类","sub-title":"",type:"line"}),o(f,{onCellClicked:O,title:u(D)(u(L).data.pid),bgType:"inverse",valueStyle:"text-align:right;",indicator:"arrow-right",boxStyle:"padding-left:32rpx;padding-right:32rpx;"},null,8,["title"]),o(a,{class:"mb-10",title:"排序","sub-title":"",type:"line"}),o(U,{class:"n-ms-ll uni-mt-5"},{default:s((()=>[o(b,{trim:"all",type:"number",modelValue:u(L).data.sort,"onUpdate:modelValue":e[1]||(e[1]=t=>u(L).data.sort=t),placeholder:"请输入整数,如99,排名越大越靠前"},null,8,["modelValue"])])),_:1}),o(a,{class:"mb-10",title:"分类名称","sub-title":"",type:"line"}),o(U,{class:"n-ms-ll uni-mt-5"},{default:s((()=>[o(b,{trim:"all",modelValue:u(L).data.name,"onUpdate:modelValue":e[2]||(e[2]=t=>u(L).data.name=t),placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),o(a,{class:"mb-10",title:"是否开启","sub-title":"",type:"line"}),o(U,{class:"n-ms-ll uni-mt-5"},{default:s((()=>[o(V,{value:u(z),"onUpdate:value":e[3]||(e[3]=t=>r(z)?z.value=t:z=t),valueLabel:"value",limits:1,textLabel:"title",items:u(E),direction:"right",isBetween:!0,itemBoxStyle:"background-color:#F5F7F9;padding-left:32rpx;padding-right:32rpx;",boxStyle:"border-radius:16rpx;overflow:hidden;"},null,8,["value","items"])])),_:1}),o(U,{class:"n-ms-ll uni-mt-5 n-ps-top-ll"},{default:s((()=>[o(C,{onButtonClicked:A,bgType:"primary",textType:"inverse",border:"none",text:"清空数据(更新后必须清空ID)"})])),_:1}),o(U,{class:"n-ms-ll uni-mt-5 n-ps-top-ll"},{default:s((()=>[o(C,{onButtonClicked:J,bgType:"error",textType:"inverse",border:"none",text:"新增/更新分类"})])),_:1}),o(U,{class:"n-ms-ll uni-mt-5 n-ps-top-ll"},{default:s((()=>[o(S,{justify:"center",isTap:!0,delay:50,value:u(I),items:u(B),indicatorHeight:"6rpx",onChange:q,indicatorType:"error",activeTextType:"error"},null,8,["value","items"])])),_:1}),o(U,{class:"n-ms-ll uni-mt-5 n-ps-top-ll"},{default:s((()=>[(l(!0),d(p,null,m(u(Q),((t,e)=>(l(),i(H,{key:t.id,rightText:u(P)(t.is_show),clickable:!0,onClick:e=>function(t){z.value=[t.is_show],L.data=t,F.value[0]=t.pic}(t),title:t.name,note:"分类id:"+t.id+"-排序："+t.sort,showArrow:"",thumb:t.pic,"thumb-size":"lg"},null,8,["rightText","onClick","title","note","thumb"])))),128))])),_:1})])),_:1})}}};export{S as default};
