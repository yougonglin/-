import{n as e,V as t,r as a,d as l,o as s,c as n,w as i,i as o,g as u,h as r,u as f,F as d,a as p,G as c,b as m,k as _,t as h,U as g,m as x}from"./index-dd065053.js";import{_ as v}from"./uni-list-item.5e9f74de.js";import{a as w,r as y}from"./uni-app.es.ce8d824d.js";import{_ as j}from"./uni-list.1c7d20cf.js";import{_ as b}from"./uni-card.bcb6abe2.js";import{_ as k}from"./uni-pagination.5591698a.js";import{_ as z,a as C}from"./uni-popup.4b06af63.js";import{e as O,f as S,h as F,i as J}from"./shop.dc051026.js";import"./uni-icons.721cc791.js";import"./request.d55298d6.js";const N={__name:"deliver",setup(N){let T=a(0),q=a(1),A=a([]),E=a(null),G=a(null),I=a([]);const L=l((()=>e=>JSON.parse(e))),U=l((()=>e=>{switch(e){case 0:return"未发货";case 1:return"已发货";case-1:return"已退款"}}));function V(a,l){var s;a=JSON.parse(a),(s="https://t.17track.net/zh-cn#nums="+a[l])&&(-1!=s.indexOf("http")?window.open(s):e({url:s,fail(){t({url:s})}})),console.log(a[l])}function B(){S(q.value).then((e=>{A.value=e.data.data.result,T.value=e.data.data.c}))}function D(e){q.value=e.current,B()}function H(e){(e=e.trim())&&(A.value[I.value[1]].num-A.value[I.value[1]].refund_num-e>=0?F(I.value[0],e).then((e=>{e.data.data?A.value.splice(I.value[1],1):c({title:"退款失败",icon:"error"})})):c({title:"退款的太多了!",icon:"error",duration:5e3}))}function K(e){(e=e.trim())&&J(I.value[0],e).then((e=>{e.data.data?(A.value.splice(I.value[1],1),E.value.close()):c({title:"更新订单失败",icon:"error"})}))}return w((e=>{e.id?O(e.id).then((e=>{A.value=e.data.data})):B()})),(e,t)=>{const a=y(m("uni-list-item"),v),l=y(m("uni-list"),j),c=x,w=o,O=y(m("uni-card"),b),S=y(m("uni-pagination"),k),F=y(m("uni-popup-dialog"),z),J=y(m("uni-popup"),C);return s(),n(w,{class:""},{default:i((()=>[(s(!0),u(d,null,r(f(A),((e,t)=>(s(),n(w,{class:"",key:e.id},{default:i((()=>[p(O,{onClick:a=>function(e,t){I.value=[e,t],g({itemList:["商品发货","商品退款"],success:e=>{e.tapIndex?G.value.open():E.value.open()}})}(e.id,t),title:"编号:"+e.id,"sub-title":"实际付款:"+e.num+"|已退款:"+e.refund_num,extra:f(U)(e.status),padding:"10px 0"},{default:i((()=>[(s(!0),u(d,null,r(f(L)(e.order_goods),((t,o)=>(s(),n(l,{border:!1,key:t.id},{default:i((()=>[p(a,{onClick:t=>V(e.tracking_number,o),clickable:!0,title:t.goods_name,note:"商品价格:"+t.price+"元",showArrow:"",thumb:t.image,"thumb-size":"lg",rightText:"x"+t.num},null,8,["onClick","title","note","thumb","rightText"])])),_:2},1024)))),128)),p(w,{slot:"actions",class:"card-actions"},{default:i((()=>[p(w,{class:"n-flex-row n-justify-between n-ms-top-ll"},{default:i((()=>[p(c,{style:{"font-size":"24rpx"}},{default:i((()=>[_("收件人姓名：")])),_:1}),p(c,{style:{"font-weight":"800",color:"#ff495d","font-size":"24rpx"}},{default:i((()=>[_(h(e.name),1)])),_:2},1024)])),_:2},1024),p(w,{class:"n-flex-row n-justify-between n-ms-top-ll"},{default:i((()=>[p(c,{style:{"font-size":"24rpx"}},{default:i((()=>[_("收件人电话：")])),_:1}),p(c,{style:{"font-weight":"800",color:"#ff495d","font-size":"24rpx"}},{default:i((()=>[_(h(e.phone),1)])),_:2},1024)])),_:2},1024),p(w,{class:"n-flex-row n-justify-between n-ms-top-ll"},{default:i((()=>[p(c,{style:{"font-size":"24rpx"}},{default:i((()=>[_("收件人地址：")])),_:1}),p(c,{style:{"font-weight":"800",color:"#ff495d","font-size":"24rpx"}},{default:i((()=>[_(h(e.address),1)])),_:2},1024)])),_:2},1024),p(w,{class:"n-flex-row n-justify-between n-ms-top-ll"},{default:i((()=>[p(c,{style:{"font-size":"24rpx"}},{default:i((()=>[_("订单时间：")])),_:1}),p(c,{style:{"font-weight":"800",color:"#ff495d","font-size":"24rpx"}},{default:i((()=>[_(h(e.create_time),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick","title","sub-title","extra"])])),_:2},1024)))),128)),p(S,{onChange:D,class:"n-ms-top-ll",total:f(T),pageSize:"30"},null,8,["total"]),p(J,{ref_key:"popup",ref:E,type:"dialog"},{default:i((()=>[p(F,{title:"商品发货",placeholder:"请输入快递号.多个用,隔开",mode:"input",message:"成功消息",duration:2e3,onConfirm:K})])),_:1},512),p(J,{ref_key:"popup_refund",ref:G,type:"dialog"},{default:i((()=>[p(F,{title:"商品退款,请确认订单金额",placeholder:"请输入退款金额",mode:"input",message:"成功消息",duration:2e3,onConfirm:H})])),_:1},512)])),_:1})}}};export{N as default};
