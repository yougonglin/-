import{r as e,o as l,c as o,w as r,q as t,t as s,i as n,a,v as i,al as u,l as h,u as c,N as f,e as d,j as p}from"./index-93e08a2b.js";import{m as g}from"./props.e7779fd1.js";import{u as x,a as T,b as m,_ as b,c as v}from"./usePager.62d200ee.js";import{r as y}from"./uni-app.es.4a85af97.js";import{b as S,a as w}from"./system.0fbb2200.js";const C={__name:"n-waterfall-view",props:g([["idLabel","id"],["sameHeight",!1],["calculator",null,Function],["columnGap","0"],["leftGap","0"],["rightGap","0"],"boxStyle","boxClass"]),setup(u,{expose:h}){const c=u;h({set:function(e){T(e)},concat:function(e){T(e)},remove:function(e){let l=d.value.findIndex((e=>{e[c.idLabel]}));if(l>=0){d.value.splice(l,1);const o=g.value-(f.value["i_"+e]||0);return delete f.value["i_"+e],void(g.value=o>=0?o:0)}if(l=p.value.findIndex((e=>{e[c.idLabel]})),l>=0){p.value.splice(l,1);const o=x.value-(f.value["i_"+e]||0);delete f.value["i_"+e],x.value=o>=0?o:0}},modify:function(e,l,o){let r=d.value.findIndex((e=>{e[c.idLabel]}));if(r>=0){return void(d.value[r][l]=o)}r=p.value.findIndex((e=>{e[c.idLabel]})),r>=0&&(p.value[r][l]=o)},clear:function(){d.value=[],p.value=[],g.value=0,x.value=0},clearCache:function(e){if(void 0===e)return void delete f.value["i_"+e];f.value={}}});const f=e({}),d=e([]),p=e([]),g=e(0),x=e(0);async function T(e){if(0!==e.length)if(!c.sameHeight&&c.calculator)for(const l in e){const o=e[l],r=o[c.idLabel];let t=0;const s=f.value["i_"+r];if(s&&0!==s.h)t=s.h,o.mH=t,o.m={...s};else{const e=c.calculator(o);t=e.h,f.value["i_"+r]=e,o.mH=t,o.m={...e}}g.value<=x.value?(d.value.push(o),g.value+=t):(p.value.push(o),x.value+=t)}else for(const l in e)d.value.length<=p.value.length?d.value.push(e[l]):p.value.push(e[l])}return(e,u)=>{const h=n;return l(),o(h,{class:t(["n-flex-row","n-wrap-nowrap",e.boxClass]),style:s(e.boxStyle)},{default:r((()=>[a(h,{class:"n-shrink-0",style:s({width:e.leftGap})},null,8,["style"]),a(h,{class:"n-flex-column n-flex-1"},{default:r((()=>[i(e.$slots,"left",{lefts:d.value})])),_:3}),a(h,{class:"n-shrink-0",style:s({width:e.columnGap})},null,8,["style"]),a(h,{class:"n-flex-column n-flex-1"},{default:r((()=>[i(e.$slots,"right",{rights:p.value})])),_:3}),a(h,{class:"n-shrink-0",style:s({width:e.rightGap})},null,8,["style"])])),_:3},8,["class","style"])}}},R={__name:"n-waterfall",props:g([["enableBackToTop",!1],["useLoading",!1],["loadMoreOffset",60],["columnCount","auto",[String,Number]],["columnWidth","auto"],["columnGap","0"],["leftGap","0"],["rightGap","0"],["autoUpdate",!1],["down",{use:!0,offset:u(140),inRate:.8,outRate:.2}],["up",{use:!0,offset:80}],["showScrollbar",!0],["bgType","page"],["position","static"],["top","0"],["bottom","0"],"boxStyle",["height","window-!status-!nav"],"reverse",["loadMainText","继续加载更多"],["loadingText","正在加载"],["noMoreText","没有更多啦"],["showNoMore",!0],["loadingSrc","/static/ui/loading-small.gif"],"loadingStyle","loadingImgStyle","loadingTextStyle",["refreshMainText","下拉即可刷新..."],["pullingText","释放即可刷新..."],["refreshingText","正在努力加载..."],"refreshStyle","refreshTextStyle","boxClass","loadingClass","loadingImgClass","loadingTextClass","refreshClass","refreshTextClass",["upperThreshold",50],["lowerThreshold",50],["scrollWithAnimation",!0],["refresherEnabled",!1],["refresherThreshold",45],["refresherDefaultStyle","black"],["refresherBackground","#FFFFFF"],["refresherTriggered",!1],["enableFlex",!1],["scrollAnchoring",!1]]),emits:["inited","scroll","down","up","upper","lower","pulling","refresh","restore","abort"],setup(g,{expose:C,emit:R}){const _=g,L=e(null),M=e(null),k=e(null),{nCurrentView:G,nScrollTop:E,nScrollTo:F,nScrollToTop:I,nScrollToBottom:j}=x(),{pagerState:H,nInitContentList:N,nScroll:A,nLoad:B,nReload:U,nRefresh:$,nEndSuccess:W,nEndError:D,nTouchstartEvent:O,nTouchmoveEvent:P,nTouchendEvent:Y}=T(_,R,L,M,k,G),{onScrollToUpper:q,onScrollToLower:V,onRefresherPulling:z,onRefresherRefresh:J,onRefresherRestore:K,onRefresherAbort:Q}=m(R);C({nLoad:B,nReload:U,nRefresh:$,nEndSuccess:W,nEndError:D,nScrollTo:F,nScrollToTop:I,nScrollToBottom:j});const X=h((()=>{let e="";return"-1"!=_.height&&(e+="height:"+S(_.height)+"px;"),"-1"!=_.top&&(e+="top:"+S(_.top)+"px;"),"-1"!=_.bottom&&(e+="bottom:"+S(_.bottom)+"px;"),e+_.boxStyle})),Z=h((()=>{let e="position: relative;";return e+=H.isDownReset?"transition-property: transform; transition-duration: 300ms;":"",e+=H.downHeight>0?`transform: translateY(${H.downHeight}px);`:"",e})),ee=h((()=>"position: absolute; transform: translateY(-100%); left:0;")),le=h((()=>H.downHeight>=(H.down.offset||80))),oe=h((()=>H.downHeight/(H.down.offset||80)));return h((()=>"auto"===_.columnWidth?"auto":w(_.columnWidth))),h((()=>w(_.columnGap))),h((()=>w(_.leftGap))),h((()=>w(_.rightGap))),H.down=Object.assign({use:!0,offset:u(140),inRate:.8,outRate:.2},_.down||{use:!1}),H.up=Object.assign({use:!0,offset:80},_.up||{use:!1}),setTimeout((()=>{R("inited")}),0),_.autoUpdate&&setTimeout((()=>{N()}),10),(e,u)=>{const h=y(p("n-refresher"),b),g=n,x=y(p("n-loader"),v),T=f;return l(),o(T,{class:t(["n-bg-"+e.bgType,e.boxClass]),style:s(c(X)),"upper-threshold":e.upperThreshold,"lower-threshold":e.lowerThreshold,"scroll-into-view":c(G),"scroll-top":c(E),"scroll-with-animation":e.scrollWithAnimation,"scroll-y":c(H).scrollable,"show-scrollbar":e.showScrollbar,"enable-back-to-top":e.enableBackToTop,"refresher-enabled":e.refresherEnabled,"refresher-threshold":e.refresherThreshold,"refresher-default-style":e.refresherDefaultStyle,"refresher-background":e.refresherBackground,"refresher-triggered":e.refresherTriggered,"enable-flex":e.enableFlex,"scroll-anchoring":e.scrollAnchoring,onScroll:c(A),onTouchstart:c(O),onTouchmove:c(P),onTouchend:c(Y),onTouchcancel:c(Y),onScrolltoupper:c(q),onScrolltolower:c(V),onRefresherpulling:c(z),onRefresherrefresh:c(J),onRefresherrestore:c(K),onRefresherabort:c(Q)},{default:r((()=>[a(g,{style:s(c(Z))},{default:r((()=>[c(H).down.use?(l(),o(g,{key:0,style:s(c(ee))},{default:r((()=>[a(h,{refreshing:c(H).isDownLoading,couldUnLash:c(le),rate:c(oe),mainText:e.refreshMainText,pullingText:e.pullingText,refreshingText:e.refreshingText,boxStyle:e.refreshStyle,textStyle:e.refreshTextStyle,boxClass:e.refreshClass,textClass:e.refreshTextClass},null,8,["refreshing","couldUnLash","rate","mainText","pullingText","refreshingText","boxStyle","textStyle","boxClass","textClass"])])),_:1},8,["style"])):d("",!0),a(g,{id:"n-list-top",ref:"n-list-top"},null,512),i(e.$slots,"header"),i(e.$slots,"default"),i(e.$slots,"footer"),a(g,{id:"n-list-bottom",ref:"n-list-bottom"},null,512),c(H).up.use?(l(),o(x,{key:1,isLoading:c(H).isUpLoading,hasMore:c(H).hasMore,showNoMore:e.showNoMore,mainText:e.loadMainText,loadingText:e.loadingText,noMoreText:e.noMoreText,loadingSrc:e.loadingSrc,boxStyle:e.loadingStyle,imgStyle:e.loadingImgStyle,textStyle:e.loadingTextStyle,boxClass:e.loadingClass,imgClass:e.loadingImgClass,textClass:e.loadingTextClass},null,8,["isLoading","hasMore","showNoMore","mainText","loadingText","noMoreText","loadingSrc","boxStyle","imgStyle","textStyle","boxClass","imgClass","textClass"])):d("",!0)])),_:3},8,["style"])])),_:3},8,["class","style","upper-threshold","lower-threshold","scroll-into-view","scroll-top","scroll-with-animation","scroll-y","show-scrollbar","enable-back-to-top","refresher-enabled","refresher-threshold","refresher-default-style","refresher-background","refresher-triggered","enable-flex","scroll-anchoring","onScroll","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onScrolltoupper","onScrolltolower","onRefresherpulling","onRefresherrefresh","onRefresherrestore","onRefresherabort"])}}};export{C as _,R as a};
