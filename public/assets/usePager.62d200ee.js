import{al as e,l as t,o,c as n,w as s,a as l,q as a,t as r,u as i,x as c,y as u,i as d,A as f,e as g,z as p,r as h,B as y}from"./index-93e08a2b.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import{g as w,b as S}from"./system.0fbb2200.js";const m=T({__name:"n-refresher",props:{mainText:{type:String,default:"下拉即可刷新..."},pullingText:{type:String,default:"释放即可刷新..."},refreshingText:{type:String,default:"正在努力加载..."},refreshing:{type:Boolean,default:!1},couldUnLash:{type:Boolean,default:!1},rate:{type:Number,default:0},boxStyle:{type:String,default:""},textStyle:{type:String,default:""},boxClass:{type:String,default:""},textClass:{type:String,default:""}},setup(g){const p=g;e(140);const h=t((()=>p.refreshing?p.refreshingText:y.value)),y=t((()=>p.couldUnLash?p.pullingText:p.mainText)),T=t((()=>`transition-property: transform; transition-duration: 300ms; transform: rotateZ(${p.rate>=1?"360deg":360*p.rate+"deg"});`)),w=t((()=>p.rate>.4?"opacity: 1;":"opacity: 0;"));return(e,t)=>{const p=d,y=f;return o(),n(p,{class:a([g.boxClass||"n-refresher","n-flex-row","n-justify-center"]),style:r(g.boxStyle||"width:750rpx;")},{default:s((()=>[l(p,{class:a(["n-cycle-container",g.refreshing&&"n-scroll-rotate"])},{default:s((()=>[l(p,{class:"n-u-cover n-u-c2",style:r(i(T))},{default:s((()=>[l(p,{class:"n-u-cover-cycle",style:r(i(w))},null,8,["style"])])),_:1},8,["style"])])),_:1},8,["class"]),l(y,{class:a([g.textClass||"n-u-txt"]),style:r(g.textStyle)},{default:s((()=>[c(u(i(h)),1)])),_:1},8,["class","style"])])),_:1},8,["class","style"])}}},[["__scopeId","data-v-eb42ac6c"]]),x={__name:"n-loader",props:{mainText:{type:String,default:"继续加载更多"},loadingText:{type:String,default:"正在加载"},noMoreText:{type:String,default:"没有更多啦"},isLoading:{type:Boolean,default:!1},loadingSrc:{type:String,default:"/static/ui/loading-small.gif"},hasMore:{type:Boolean,default:!0},showNoMore:{type:Boolean,default:!0},flex:{type:String,default:"column"},boxStyle:{type:String,default:""},imgStyle:{type:String,default:""},textStyle:{type:String,default:""},boxClass:{type:String,default:""},imgClass:{type:String,default:""},textClass:{type:String,default:""}},setup(e){const h=e,y=t((()=>h.hasMore?h.isLoading?h.loadingText:h.mainText:h.noMoreText));return(t,h)=>{const T=p,w=f,S=d;return o(),n(S,{class:a([e.boxClass||"n-loader","n-flex-"+e.flex,"n-align-center","n-justify-center"]),style:r(e.boxStyle)},{default:s((()=>[e.hasMore&&e.isLoading?(o(),n(S,{key:0,class:"n-flex-column n-align-center"},{default:s((()=>[l(T,{class:a([e.imgClass||"n-loader-img"]),src:e.loadingSrc,mode:"aspectFill",style:r(e.imgStyle)},null,8,["class","src","style"]),l(w,{class:a([e.textClass||"n-loader-text"]),style:r(e.textStyle)},{default:s((()=>[c(u(i(y)),1)])),_:1},8,["class","style"])])),_:1})):g("",!0),!e.hasMore&&e.showNoMore?(o(),n(w,{key:1,class:a([e.textClass||"n-loader-text"]),style:r(e.textStyle)},{default:s((()=>[c(u(i(y)),1)])),_:1},8,["class","style"])):g("",!0)])),_:1},8,["class","style"])}}};function v(){const e=h(null),t=h(0);return{nCurrentView:e,nScrollTop:t,nScrollTo:function(o,n={offset:0,animated:!0}){"string"!=typeof o?(e.value=null,t.value===o?t.value=o+.1:t.value=o):e.value=o},nScrollToTop:function(t,o={offset:0,animated:!0}){e.value="nlisttop"},nScrollToBottom:function(t,o={offset:0,animated:!0}){e.value="nlistbottom"}}}function P(e){return{onScrollToUpper:function(t){e("upper",t)},onScrollToLower:function(t){e("lower",t)},onRefresherPulling:function(t){e("pulling",t)},onRefresherRefresh:function(t){e("refresh",t)},onRefresherRestore:function(t){e("restore",t)},onRefresherAbort:function(t){e("abort",t)}}}function D(e){return e?e.touches&&e.touches[0]?{x:e.touches[0].pageX,y:e.touches[0].pageY,sX:e.touches[0].screenX,sY:e.touches[0].screenY}:e.changedTouches&&e.changedTouches[0]?{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,sX:e.changedTouches[0].screenX,sY:e.changedTouches[0].screenY}:{x:e.clientX,y:e.clientY}:{x:0,y:0,sX:0,sY:0}}function L(o,n,s,l,a,r,i){w();const c=y({isDownLoading:!1,isUpLoading:!1,down:{use:!0,offset:e(140),inRate:.8,outRate:.2},up:{use:!0,offset:80},hasMore:!0,currentPage:0,prePage:0,scrollable:!0,downHeight:0,startPoint:null,lastPoint:null,theScrollHeight:0,theScrollTop:0,startTop:0,inTouchend:!1,preScrollY:0,fps:40,moveTime:0,moveTimeDiff:0,scrollTopDeviation:100,isMoveDown:!1,downMoveType:0,isDownReset:!1}),u=t((()=>S(o.height)));function d(){c.prePage=c.currentPage,c.currentPage=1,g("refresh")}function f(){c.prePage=c.currentPage,c.currentPage+=1,g("load")}function g(e="refresh"){n("refresh"===e?"down":"up",c.currentPage)}function p(){c.scrollable=!0,c.isDownReset=!0,c.isDownLoading=!1,c.downHeight=0}function h(){if(c.isDownLoading||c.isUpLoading||!c.hasMore||!c.up.use)return;let e=!1;(function(){let e=u.value;c.theScrollHeight>0&&(e=c.theScrollHeight);return e-c.theScrollTop-u.value})()<=c.up.offset&&(e=!0),e&&(c.isUpLoading=!0,f())}function T(){c.isUpLoading=!1}return{pagerState:c,nInitContentList:function(){c.prePage=0,c.currentPage=1,g("refresh")},nScroll:function(e){n("scroll",e),c.theScrollTop=e.detail.scrollTop,c.theScrollHeight=e.detail.scrollHeight;const t=e.detail.scrollTop-c.preScrollY>0;c.preScrollY=e.detail.scrollTop,t&&h(),r.value&&(r.value=null)},nRefresh:d,nReload:function(){c.prePage=c.currentPage,c.currentPage=1,g("load")},nLoad:f,nEndSuccess:function(e=!1){c.hasMore=e||!1,c.isDownLoading&&p(),c.isUpLoading&&T()},nEndError:function(){c.currentPage=c.prePage,c.isDownLoading&&p(),c.isUpLoading&&T()},nTouchstartEvent:function(e){o.isChild&&!c.scrollable||(c.startPoint=D(e),c.startTop=c.theScrollTop||0,c.lastPoint=c.startPoint,c.inTouchend=!1)},nTouchmoveEvent:function(e){if(o.isChild&&!c.scrollable)return;if(!c.down.use&&!o.isChild)return;if(!c.startPoint)return;const t=(new Date).getTime();if(c.moveTime&&t-c.moveTime<c.moveTimeDiff)return;c.moveTime=t,c.moveTimeDiff=1e3/c.fps;const s=c.theScrollTop,l=D(e);if(l.y-c.startPoint.y>0&&(s<=0||s<=c.scrollTopDeviation&&s<=c.startTop)){i.value=0==i.value?.01:0;const e=l.y-c.lastPoint.y;if(o.isChild)return c.downHeight+=e,n("move",c.downHeight),void(c.lastPoint=l);if(!c.inTouchend&&!c.isDownLoading&&!c.isUpLoading){c.downHeight<c.down.offset?(1!==c.downMoveType&&(c.downMoveType=1,c.scrollable=!1,c.isDownReset=!1,c.isDownLoading=!1,c.isMoveDown=!0),c.downHeight+=e*c.down.inRate):(2!==c.downMoveType&&(c.downMoveType=2,c.scrollable=!1,c.isDownReset=!1,c.isDownLoading=!1,c.isMoveDown=!0),c.downHeight+=e>0?Math.round(e*c.down.outRate):e);c.downHeight,c.down.offset;c.downHeight}}c.lastPoint=l},nTouchendEvent:function(e){if((!o.isChild||c.scrollable)&&c.startPoint){if(c.isMoveDown)i.value=0==i.value?.01:0,c.downHeight>=c.down.offset?(c.scrollable=!0,c.isDownReset=!0,c.isDownLoading=!0,c.downHeight=c.down.offset,d()):(c.downHeight=0,p()),c.downMoveType=0,c.isMoveDown=!1;else if(c.theScrollTop===c.startTop){D(e).y-c.startPoint.y<0&&h()}console.log("end dh",c.downHeight)}}}}export{m as _,L as a,P as b,x as c,D as g,v as u};
