import{r as e,X as t,g as l,o as a,c as r,w as n,i as o,a as i,x as s,u,G as p,t as c,e as d,Z as m,h,a8 as x,f,ap as g,s as v,A as y,j as b}from"./index-93e08a2b.js";import{_}from"./n-input.81ae90a1.js";import{o as S,r as j}from"./uni-app.es.4a85af97.js";import{_ as w}from"./n-button.3162a993.js";import{_ as k}from"./n-icon.3d1c4127.js";import{_ as z}from"./vaptcha-v3.76b405fa.js";import{p as C}from"./pcToWeb.b1a5f010.js";import{s as T}from"./common.b5c70975.js";import{t as U}from"./util.84ba036b.js";import"./props.e7779fd1.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-qrcode.710744ab.js";import"./bulletinBoard.bc6e3929.js";import"./n-bg-view.98391b2e.js";const I={__name:"phoneCodeLogin",setup(I){let L=e(0),E=e(!1),P=null,B=e(""),N=e(""),R=e(0),D=e(!1),H=e(m.HTTP_REQUEST_URL+"/tcaptcha.html"),J=e("");function q(e){if(console.log(e),E.value=!1,0==e.ret){if(R.value>0)return;T(B.value,e.ticket,e.randstr,J.value).then((e=>{if(console.log(e.data),"verifyError"==e.data)return void h({title:"图形验证码错误,请重新输入!",icon:"error"});let t=JSON.parse(e.data);switch(t.SendStatusSet[0].Code){case"InvalidParameterValue.IncorrectPhoneNumber":h({title:"手机号输入错误,请检查并重新输入",icon:"error"});break;case"Ok":R.value=60,P=setInterval((()=>{R.value-=1,R.value<=0&&(R.value=0,P&&clearInterval(P),P=null)}),1e3);break;case"LimitExceeded.PhoneNumberThirtySecondLimit":case"LimitExceeded.PhoneNumberSameContentDailyLimit":h({title:"验证码发送过快,请稍等60秒后重试",icon:"error"});break;default:h({title:t.SendStatusSet[0].Message,icon:"error"})}}))}}function A(){if(B.value){if(R.value>0)return;x(),E.value=!0}else h({title:"请先输入手机号",icon:"error"})}function O(){console.log(1111113),D.value=!D.value}function Q(e){U(e)}function W(){if(D.value){let e=f("oaid"),t=f("leafletUid");g({phone:B.value,smsCode:N.value,inviteUid:f("inviteUid"),oaid:e,leafletUid:t}).then((e=>{200==e.data.code?(v("loginToken",e.data.data),location.href="/"):h({title:e.data.msg,icon:"error"})}))}else h({title:"请先同意协议",icon:"error"})}return S((()=>{L.value=t().windowHeight;let e=setInterval((()=>{l().globalData.t&&(J.value=l().globalData.t,clearInterval(e))}),100)})),(e,t)=>{const l=y,m=o,h=j(b("n-input"),_),x=j(b("n-button"),w),f=j(b("n-icon"),k),g=j(b("vaptcha-v3"),z);return a(),r(m,{class:"n-flex-1 n-full-height n-bg-inverse"},{default:n((()=>[i(m,{style:{"margin-top":"66rpx","margin-left":"75rpx"}},{default:n((()=>[i(l,{class:"n-weight-7",style:{"font-size":"60rpx","line-height":"84rpx"}},{default:n((()=>[s("欢迎来到超新星")])),_:1}),i(l,{class:"n-size-s n-color-third",style:{"line-height":"40rpx","margin-top":"6rpx"}},{default:n((()=>[s("未注册手机验证后自动登录")])),_:1})])),_:1}),i(l,{class:"n-size-ll n-color-text n-lh-ll n-weight-7",style:{"margin-left":"75rpx","margin-top":"100rpx"}},{default:n((()=>[s("手机号码")])),_:1}),i(h,{valueStyle:"height:182rpx;",value:u(B),"onUpdate:value":t[0]||(t[0]=e=>p(B)?B.value=e:B=e),type:"number",maxlength:11,placeholder:"请输入手机号",border:"bottom",boxStyle:"height:92rpx;margin-left:75rpx;margin-right:75rpx;margin-top:12rpx;"},null,8,["value"]),i(l,{class:"n-size-ll n-color-text n-lh-ll n-weight-7",style:{"margin-left":"75rpx","margin-top":"56rpx"}},{default:n((()=>[s("短信验证码")])),_:1}),i(h,{valueStyle:"height:182rpx;",value:u(N),"onUpdate:value":t[1]||(t[1]=e=>p(N)?N.value=e:N=e),type:"number",maxlength:6,placeholder:"短信验证码",border:"bottom",boxStyle:"height:92rpx;margin-left:75rpx;margin-right:75rpx;margin-top:12rpx;"},{extra:n((()=>[i(m,{class:"n-border-left"},{default:n((()=>[i(x,{text:u(R)?u(R)+"s":"获取",textType:"error",textSize:"base",boxStyle:"width:160rpx;height:72rpx;",onButtonClicked:A},null,8,["text"])])),_:1})])),_:1},8,["value"]),i(m,{class:"n-flex-row n-justify-center",style:{"margin-top":"96rpx"}},{default:n((()=>[i(x,{onButtonClicked:W,text:"登陆",textType:"inverse",textSize:"l",bgType:"gradient",radius:"ll",boxStyle:"width:600rpx;height:100rpx;"})])),_:1}),i(m,{class:"n-flex-column n-align-center",style:{width:"750rpx"}},{default:n((()=>[i(m,{class:"n-flex-row n-align-center",style:{"margin-top":"60rpx"}},{default:n((()=>[i(f,{name:u(D)?"check-solid":"circle",type:u(D)?"text":"third",size:"ll",onIconClicked:O},null,8,["name","type"]),i(l,{class:"n-color-third n-size-s n-lh-s",style:{"margin-left":"12rpx"}},{default:n((()=>[s("同意")])),_:1}),i(l,{class:"n-color-text n-size-s n-lh-s",onClick:t[2]||(t[2]=e=>Q("https://note.youdao.com/s/Jk60t1c8"))},{default:n((()=>[s("《隐私协议》")])),_:1}),i(l,{class:"n-color-third n-size-s n-lh-s"},{default:n((()=>[s("和")])),_:1}),i(l,{class:"n-color-text n-size-s n-lh-s",onClick:t[3]||(t[3]=e=>Q("https://note.youdao.com/s/b7Bqvg3S"))},{default:n((()=>[s("《用户协议》")])),_:1})])),_:1})])),_:1}),u(E)?(a(),r(g,{key:0,style:c([{position:"fixed",top:"0",left:"0",width:"750rpx","min-width":"100%"},{height:u(L)+"px"}]),url:u(H),onReceive:q},null,8,["style","url"])):d("",!0),i(C,{pcCanUse:!0})])),_:1})}}};export{I as default};
